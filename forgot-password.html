<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - To-Do List App</title>
    <link rel="stylesheet" href="auth.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h2>Forgot Password</h2>
                <p>Enter your email address to reset your password</p>
            </div>
            
            <form id="forgot-password-form" class="auth-form">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" required>
                    <div id="email-error" class="error-message"></div>
                </div>
                
                <button type="submit" class="auth-button">Continue</button>
                
                <div class="auth-links">
                    <a href="login.html">Back to Login</a>
                </div>
            </form>
            
            <form id="direct-reset-form" class="auth-form" style="display: none;">
                <input type="hidden" id="reset-email" name="reset-email">
                <input type="hidden" id="reset-token" name="reset-token">
                
                <div class="form-group">
                    <label for="new-password">New Password</label>
                    <div class="password-input-container">
                        <input type="password" id="new-password" name="new-password" required>
                        <button type="button" class="toggle-password">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div id="new-password-error" class="error-message"></div>
                    
                    <div class="password-strength">
                        <div class="strength-meter">
                            <div id="strength-meter-fill" class="strength-meter-fill"></div>
                        </div>
                        <div id="password-strength-text" class="strength-text">Password strength</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="confirm-new-password">Confirm Password</label>
                    <div class="password-input-container">
                        <input type="password" id="confirm-new-password" name="confirm-new-password" required>
                        <button type="button" class="toggle-password">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div id="confirm-new-password-error" class="error-message"></div>
                </div>
                
                <button type="submit" class="auth-button">Reset Password</button>
                
                <div class="auth-links">
                    <a href="#" id="back-to-email">Back to Email Entry</a>
                </div>
            </form>
            
            <div id="reset-success" class="success-message" style="display: none;">
                <i class="fas fa-check-circle"></i>
                <p>Password reset request successful!</p>
                <p><strong>Note:</strong> This is a demo app. In a real application, instructions would be sent to your email.</p>
                <p>For this demo, you can reset your password directly below:</p>
                <button id="show-reset-form" class="auth-button" style="margin-bottom: 10px;">Reset Password Now</button>
                <a href="login.html" class="auth-button">Back to Login</a>
            </div>
            
            <div id="reset-complete" class="success-message" style="display: none;">
                <i class="fas fa-check-circle"></i>
                <p>Your password has been successfully reset!</p>
                <a href="login.html" class="auth-button">Log In Now</a>
            </div>
        </div>
    </div>
    
    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set up the show reset form button
            const showResetFormBtn = document.getElementById('show-reset-form');
            if (showResetFormBtn) {
                showResetFormBtn.addEventListener('click', function() {
                    document.getElementById('reset-success').style.display = 'none';
                    document.getElementById('direct-reset-form').style.display = 'block';
                });
            }
            
            // Set up the back to email button
            const backToEmailBtn = document.getElementById('back-to-email');
            if (backToEmailBtn) {
                backToEmailBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.getElementById('direct-reset-form').style.display = 'none';
                    document.getElementById('forgot-password-form').style.display = 'block';
                });
            }
            
            // Set up the direct reset form
            const directResetForm = document.getElementById('direct-reset-form');
            if (directResetForm) {
                directResetForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const email = document.getElementById('reset-email').value;
                    const token = document.getElementById('reset-token').value;
                    const newPassword = document.getElementById('new-password').value;
                    const confirmPassword = document.getElementById('confirm-new-password').value;
                    
                    // Reset error messages
                    document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
                    
                    // Validate password
                    if (newPassword.length < 8) {
                        document.getElementById('new-password-error').textContent = 'Password must be at least 8 characters';
                        return;
                    }
                    
                    // Validate password confirmation
                    if (newPassword !== confirmPassword) {
                        document.getElementById('confirm-new-password-error').textContent = 'Passwords do not match';
                        return;
                    }
                    
                    // Reset the password
                    const success = window.authUtils.resetPassword(email, token, newPassword);
                    
                    if (success) {
                        directResetForm.style.display = 'none';
                        document.getElementById('reset-complete').style.display = 'block';
                    } else {
                        document.getElementById('new-password-error').textContent = 'Password reset failed. Please try again.';
                    }
                });
            }
        });
    </script>
</body>
</html>